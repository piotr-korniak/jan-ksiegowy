--liquibase formatted sql
--changeset piotrkorniak:1

--- CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE METRICS (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
--- PARENT_ID BIGINT,
    DATE DATE NOT NULL,
    NIP VARCHAR(13),
    KRS VARCHAR(10),
    REGON VARCHAR(9),
    NAZWA VARCHAR(128),
    ADRES VARCHAR(64),
    MIASTO VARCHAR(64),
    POCZTA VARCHAR(32),
    MIEJSCE VARCHAR(64),
    KAPITAL DECIMAL(12,2) NOT NULL,
    US_ID BIGINT,

    PRIMARY KEY (ID)
---    FOREIGN KEY (PARENT_ID) REFERENCES METRICS(ID)
);

CREATE TABLE ENTITIES (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
--- ID UUID,
    ENTITY_ID UUID,
    TYPE CHAR(1),
    DATE DATE NOT NULL,
    ACCOUNT_NUMBER VARCHAR(12),
    TAX_NUMBER VARCHAR(13),
    REGISTRATION_NUMBER VARCHAR(32),
    NAME VARCHAR(128),
    ADDRESS VARCHAR(64),
    TOWN VARCHAR(32),
    POSTCODE VARCHAR(7),
    COUNTRY VARCHAR(2),
    SUPPLIER BOOLEAN,
    CUSTOMER BOOLEAN,
    VAT_UE BOOLEAN,

    PRIMARY KEY (ID),
---   FOREIGN KEY (PARENT_ID) REFERENCES CONTACTS(ID)
    UNIQUE (ENTITY_ID, DATE)
---    UNIQUE (TAX_NUMBER, COUNTRY, DATE)
);

--changeset piotrkorniak:2
INSERT INTO pl5862321911.METRICS ( DATE, NIP, REGON, NAZWA, ADRES, MIASTO, POCZTA, MIEJSCE, KAPITAL, US_ID) VALUES
( '2017-08-30', '5862321911', '368141215', 'Eleutheria Usługi Informatyczne Sp. z o.o.', 'ul. Starowiejska 16/2', 'Gdynia', '81-356', 'Gdynia', 0, 15),
( '2022-07-15', '5862321911', '368141215', 'Eleutheria Usługi Informatyczne Sp. z o.o.', 'ul. Wiejska 24a', 'Rumia', '84-230', 'Rumia', 0, 93);

--changeset piotrkorniak:3
CREATE TABLE SETTLEMENTS (
    ID UUID,
    METRIC_ID BIGINT,
    ENTITY_ID BIGINT,

    TYPE CHAR(1),

    DATE DATE NOT NULL,
    DUE DATE NOT NULL,

    PRIMARY KEY (ID),
    FOREIGN KEY (METRIC_ID) REFERENCES METRICS(ID),
    FOREIGN KEY (ENTITY_ID) REFERENCES ENTITIES(ID)
);

CREATE TABLE INVOICES (
    SETTLEMENT_ID UUID,
    DATE DATE NOT NULL,

    FOREIGN KEY (SETTLEMENT_ID) REFERENCES SETTLEMENTS(ID)
);